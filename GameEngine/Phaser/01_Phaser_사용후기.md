# Phaser 사용 후기

페이저를 사용하여 간단한 애니팡 스타일의 간단한 3매치 게임을 만들어 보았다.

[게임하러가기](http://hgcho-phaser.appspot.com/anipang)
	
[게임 코드 보러가기](https://github.com/HyegeunCho/hgcho-phaser)

이 게임은 페이저 엔진에서 예제로 제공하는 gemmatch 예제를 활용하여 만들어졌다.
gemmatch 예제를 페이저 에디터로 옮긴 후, 애니팡 리소스, 애니메이션 연출 및 게임 규칙들을 추가하여 완성하였다.

이 문서는 게임을 만들면서 느낀 점과 의문점을 공유하기 위해 작성하였다.

## 페이저 에디터의 특이점

페이저 엔진 자체는 무료이나 페이저 엔진 개발용 에디터를 약 4만원 정도의 가격으로 판매하고 있다.

[페이저 엔진 보러가기](https://phaser.io)

[페이저 에디터 보러가기](http://phasereditor.boniatillo.com)

### Asset Pack 파일로 Asset 관리

페이저 에디터에서는 에셋을 패키징하여 json 파일로 관리한다.

! 여기 페이저 에디터의 에셋 패키지 사진 추가할 것.

에셋 묶음을 key 베이스로 관리할 수 있다. 이것을 Section 이라고 한다.

하나의 에셋 묶음은 다음과 같이 다양한 타입의 에셋을 포함할 수 있다.

- image
- spritesheet
- atlas
- audio
- audiosprite
- video
- tilemap
- bitmapFont
- physics
- text
- json
- script
- shader
- binary

즉, 하나의 씬을 구성하는 에셋들을 분리하여 섹션 별로 구성할 수 있다는 것이다.

실제로 에셋 패키지를 로드할 때 코드를 보면 섹션의 key 값을 명시하여 섹션 별로 에셋들을 로드하는 것을 볼 수 있다.

예제에서는 ingame 섹션 하나만 생성하여 에셋을 관리했기 때문에 에셋 팩의 기능을 제대로 체험할 순 없었다. 

아래와 같은 내용을 확인해봐야 한다.

```
에셋 패키지에서 섹션별로 로드를 구분해서 얻는 이점을 알아보자

실제 game.load.pack 함수가 어떤 동작을 하는지 확인할 필요가 있다!
load, unload를 통해 메모리를 여유롭게 활용하기 위해?
unload API가 실제로 있나?
unload 하면 실제로 메모리 deallocation되나?
씬을 더 빨리 열기 위해 각 씬에 필요한 에셋만 로드하기 위해?
```

### Scene (canvas 파일)

페이저 에디터에서는 Scene을 통해 WYSIWYG을 지원한다.
씬을 생성하면 `.canvas` 확장자를 갖는 파일을 생성하며, 에디터에서 해당 파일을 열면 페이저 에디터만의 씬 화면이 열린다.

!여기 페이저 에디터의 씬 사진 추가할 것.

위에서 정의한 asset pack 파일을 통해 프로젝트에 추가된 이미지들을 드래그 앤 드롭하여 씬 상에 배치하여 게임 화면을 간단하게 구성할 수 있다.

또한 씬의 프로퍼티 윈도우에서 씬 상에 배치한 이미지들의 속성을 쉽게 수정할 수 있다.

예제를 만들면서 개인적으로 느낀 씬 에디터의 장점은 다음과 같다.

1. 화면 상에 기본으로 배치되어 있는 UI와 같은 이미지들을 편집하기 매우 편리했다.
2. WYSIWYG이므로 좌표 확인이 매우 간편하다. 

특히 2D 게임에서 자주 사용되는 버튼이나 타일 스프라이트 같은 객체로의 변경도 씬에서 매우 간단하게 적용하고 프로퍼티 변경도 간단하게 할 수 있다.

canvas 파일을 수정한 후 저장하면 해당 canvas 파일을 정보를 토대로 씬에 배치된 객체들을 생성, 관리하는 js 파일이 자동으로 생성된다. 

해당 js 파일에서는 canvas 파일로 생성된 씬 하나를 하나의 객체로 만들어 전역 환경에 게시한다(표현이 좀... 전역환경에서 접근할 수 있는 객체로 생성한다..)

처음 예제를 만들때는 페이저 에디터를 사용하지 않았기 때문에 씬 객체가 추가로 생기면서 스코프에 꽤나 혼란이 왔었다. 

**차후 페이저 엔진, 혹은 어떤 HTML5 게임 엔진을 사용하든 자바스크립트 코딩 가이드와 설계 가이드를 명확하게 세워야만 할 것이다.**

canvas 파일을 열어보면 JSON 파일 형식임을 알 수 있다.
에디터에서는 canvas 파일을 파싱하여 js 파일을 생성한다. 

[예제의 canvas 파일 보러가기](https://github.com/HyegeunCho/hgcho-phaser/blob/master/assets/scenes/ingame.canvas)
[예제의 scene js 파일 보러가기](https://github.com/HyegeunCho/hgcho-phaser/blob/master/assets/scenes/ingame.js)



### 디자이너와의 협업

예제에서의 이미지 리소스들은 애니팡의 fla 파일에서 필요한 리소스들을 **PNG 시퀀스**로 저장한 후, **Texture Packer**를 사용하여 이미지 아틀라스로 만든 후 사용하였다.

현 버전의 Texture Packer는 이미 페이저 엔진용 이미지 아틀라스 세팅을 두가지 제공하고 있다.

1. JSON Array 방식
2. JSON Hash 방식

어떤 방식으로 이미지 아틀라스를 생성하든 상관없다. 페이저 엔진에서 아틀라스 로딩 시 플래그 옵션만 바꿔주면 된다.

그런데 사실 플래시 파일 안에는 이미 UI 이미지들의 좌표까지 지정되어 저장되어 있는 상태이다. 

**그렇다면 굳이 canvas 씬에서 한번 더 이미지를 배치하는 과정을 생략하고 Common Sprite Packer에서 swf 파일을 분석해서 바로 canvas 파일과 js 파일을 만들 수 있지 않을까?**
> 그런데 canvas 파일에 id 값이 어떻게 사용되는지 모르겠다.... 
> js 파일을 자동생성할 때 사용되는건가;; 
> 기존 canvas 파일을 수동 조작한 후 페이저 에디터에서 한번 열어보자...
> ! TEST 필요 !

** 애니메이션의 경우에도 플래시를 이용하여 디자이너입장에서 더 편리하게 애니메이션을 생성한 후 Common Sprite Packer 를 사용하여 아틀라스로 뽑아내면 편리할 것 같다.**

문제는... 앞으로도 회사에서 플래시를 사용하느냐 하는 점이다. 어차피 파일 형식을 분석해서 이미지 아틀라스만 만들 수 있으면 상관없으니 디자이너가 어떤 툴을 사용하여 이미지 작업 및 애니메이션 작업을 할지에 따라 Common Sprite Packer 작업이 필요하다.



